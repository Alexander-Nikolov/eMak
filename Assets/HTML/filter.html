<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Лаптопи</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../CSS/reset.css">
    <link rel="stylesheet" href="../CSS/filters.css">
</head>

<body>
    <div id="wrapper">
        <div id="fixedNav">
        </div>
        <header>
            <div id="logo">
                <div id="logoAndSearch">
                    <div id="logoImg">
                        <a href="index.html">
                            <img src="../Images/logo.png" alt="The logo of the site">
                        </a>
                    </div>
                    <div id="search">
                        <div id="searchForm">
                            <!-- <div id="arrowLeft"></div> -->
                            <form id="searchBar">
                                <input type="text" name="searchBar" placeholder="Какво търсиш днес?" />
                                <div id="searchButton">
                                    <a href=""><span class="glyphicon glyphicon-search"></span></a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div id="myBar">
                    <div id="myAccount">
                        <a href="../login.html">
                            <span class="glyphicon glyphicon-user icons"></span>
                            <span class="textContent">Моят акаунт</span>
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </a>
                    </div>
                    <div id="myFavorites">
                        <a href="">
                            <span class="glyphicon glyphicon-heart icons"></span>
                            <span class="textContent">Любими</span>
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </a>
                    </div>
                    <div id="myCart">
                        <a href="">
                            <span class="glyphicon glyphicon-shopping-cart icons"></span>
                            <span class="textContent">Моята количка</span>
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </a>
                    </div>
                </div>
            </div> 
        </header>
        <span id="mobileMenuButton" class="glyphicon glyphicon-align-justify">Меню</span>
        <div id="mobilemenu">
            <div class="navMenuItems">
                <a href="">Продукти</a>
            </div>
            <div class="navMenuItems">
                <a href="">Абониране за бюлетин</a>
            </div>
            <div class="navMenuItems">
                <a href="">Разопаковани продукти</a>
            </div>
            <div class="navMenuItems">
                <a href="">eMAG инфо</a>
            </div>
        </div>
        <nav>
            <div class="navMenuItems">
                <span class="glyphicon glyphicon-align-justify"></span>
                <a href="">Продукти</a>
            </div>
            <div class="navMenuItems">
                <a href="">Абониране за бюлетин</a>
            </div>
            <div class="navMenuItems">
                <a href="">Разопаковани продукти</a>
            </div>
            <div class="navMenuItems">
                <a href="">eMAG инфо</a>
            </div>
        </nav>
        <main>
            <aside>
                <div>
                    <h2> Цена: </h2>
                    <form id="prices">
                        <div>
                            <input type="checkbox" name="price" min="0" max="100" value="1"/>Под 100
                        </div>
                        <div>
                            <input type="checkbox" name="price" min="100" max="200" value="2"/>100-200
                        </div> 
                        <div>
                            <input type="checkbox" name="price" min="200" max="500" value="3"/>200-500
                        </div>
                        <div>
                            <input type="checkbox" name="price" min="500" max="1000" value="4"/>500-1000
                        </div>
                        <div>
                            <input type="checkbox" name="price" min="1000" max="2000" value="5"/>1000-1500
                        </div>
                        <div> 
                            <input type="checkbox" name="price" min="1500" max="10000" value="6"/>Над 1500
                        </div>
                    </form>
                </div>
                <div>
                    <h2> Производител: </h2>
                    <form id="brand">

                    </form>
                </div>
            </aside>
            <div id="products">

            </div>
        </main>

    </div>
</body>
<script>
    var request = new XMLHttpRequest();
    request.open("GET", "../JavaScript/jsonfiles/laptops.json", false);
    request.send(null);
    var products = JSON.parse(request.responseText);

    var divBrand = document.getElementById('brand');
    products.forEach(function(element){
        var check = document.createElement('input');
        check.id = element.brand;
        check.type = "checkbox";
        check.name = "brand";
        check.value = element.brand;
        var label = document.createElement('label');
        label.for = check.id;
        label.innerHTML = element.brand;
        var div = document.createElement('div');
        div.appendChild(check);
        div.appendChild(label);
        brand.appendChild(div);
    });

    products.forEach(function(element) {
        var div = document.createElement('div');
        var info = document.createElement('h1');
        info.innerHTML = element.info;
        div.appendChild(info);
        var price = document.createElement('p');
        price.id = "price";
        price.innerHTML = element.price;
        div.appendChild(price); 
        var img = document.createElement('img');
        img.src = element.img;
        div.appendChild(img);
        div.className = "product";
        document.getElementById('products').appendChild(div);
    });

    var inputs = document.querySelectorAll('input[type=checkbox]');

    function checkPrice(from, to) {
        return function(element) {
            var price = parseInt(element.price);
            if (price >= from && price <= to){
                return true;
            }
            return false;
        }
    }

    function checkBrand(brand) {
        return function(element){
            if (element.brand == brand) {
                return true;
            }
            return false;
        }
    }

    function getProducts(array) {
        var result = [];

        for (var check = 0; check < array.length; check++) {
            var currentResult = products.filter((array[check].parentElement.parentElement.id == "prices") ? (checkPrice(parseInt(array[check].min), parseInt(array[check].max))) : checkBrand(array[check].value));
            Array.prototype.forEach.call(currentResult, function(element) {
                result.push(element);
            });
        }
        return result;
    }

    inputs.forEach(function(element) {
        element.addEventListener('change', function(event){
            var checkboxes = document.getElementsByTagName('input');
            var pricesChecked = [];
            var brandsChecked = [];

            Array.prototype.forEach.call(checkboxes, function(checkbox){
                if (checkbox.checked){
                    var array = (checkbox.parentElement.parentElement.id == 'prices') ? pricesChecked : brandsChecked;
                    array.push(checkbox);
                }
            }); 

            var displayProducts = (pricesChecked.length != 0 || brandsChecked.length != 0) ? "none" : "block";  
            var productsDiv = document.querySelectorAll('.product');
            productsDiv.forEach(function(div) {
                div.style.display = displayProducts;
            });
            
            var resultPrice = getProducts(pricesChecked);
            var resultBrand = getProducts(brandsChecked);

            var result = [];

            if (resultPrice.length != 0 && resultBrand.length != 0){
                for (var i = 0; i < resultPrice.length; i++){
                    for (var j = 0; j < resultBrand.length; j++) {
                        if(resultBrand[j] == resultPrice[i]){
                            result.push(resultBrand[j]);
                        }
                    }
                }
            } else {
                result = resultBrand.length != 0 ? resultBrand : resultPrice;
            }

            for (var index = 0; index < result.length; index++) {
                productsDiv.forEach(function(div) {
                    if (div.children[0].innerHTML == result[index].info){
                        div.style.display = "block";
                    }
                });
            }
        }, false);
    });
</script>
</html>